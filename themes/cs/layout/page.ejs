<%- include('partial/head.ejs') %>
    <main class="main" id="top">
        <%- include('partial/menu.ejs') %>
            <div class="container" style="margin-top: 100px;">
                <div class="rowjustify-content-center circle">
                    <div class="col-md-14 col-lg-12 py-12 text-sm-start text-center">
                        <h5 class="fw-bold fs-3 fs-lg-5 lh-sm mb-3">
                            <%= page.title %>
                        </h5>
                        <% if (page.path==='projects/index.html' ) { %>
                            <!-- <h6>На этой странице представлены все проекты для гражданских учёных, которые нам известны. -->
                                <h6>
                                    <div>

                                        <div class="container container-md-fluid">
                                            <div
                                                class="row flex-center h-100 circle-blend circle-blend-left circle-cyan">
                                                <div class="col-12">
                                                    <div
                                                        class="row align-items-center circle-blend circle-blend-right circle-warning">
                                                        <div class="col-md-6 col-lg-8 mb-8">
                                                            <div class="card card-bg p-3 h-100 ">
                                                                <div class="card-body">
                                                                    <h6 class="text-gradient fs--1 fw-bold">Фильтр
                                                                        проектов по:</h6>
                                                                    <div class="container container-md-fluid">
                                                                        <div class="row">
                                                                            <div
                                                                                style="width: auto; float:left; height:auto; margin:10px">
                                                                                <h7>Направления</h7>
                                                                                <div>
                                                                                    Космос <input type="checkbox"
                                                                                        id="space"><br>
                                                                                    Земля <input type="checkbox"
                                                                                        id="earth"><br>
                                                                                    Вода <input type="checkbox"
                                                                                        id="water"><br>
                                                                                    Воздух <input type="checkbox"
                                                                                        id="air"><br>
                                                                                    Животные (Биология) <input
                                                                                        type="checkbox"
                                                                                        id="animals"><br>
                                                                                    Растения <input type="checkbox"
                                                                                        id="plants"><br>
                                                                                    Физика <input type="checkbox"
                                                                                        id="physics"><br>
                                                                                    Математика <input type="checkbox"
                                                                                        id="mathematics"><br>
                                                                                    Археология <input type="checkbox"
                                                                                        id="archeology"><br>
                                                                                    Остальное <input type="checkbox"
                                                                                        id="other"><br>
                                                                                </div>
                                                                                <!-- <button type="button">Выбрать все</button> -->
                                                                            </div>
                                                                            <div
                                                                                style="width: auto; float:left; height:auto; margin:10px">
                                                                                <h7>Локация</h7>
                                                                                <div>
                                                                                    Можно из дома <input type="checkbox"
                                                                                        id="homeCheckbox"><br>
                                                                                    На природе <input type="checkbox"
                                                                                        id="natureCheckbox"><br>
                                                                                </div>
                                                                                <h7>Степень участия</h7>
                                                                                <div>
                                                                                    Активная помощь <input
                                                                                        type="checkbox"
                                                                                        id="activeParticipation"
                                                                                        class="switcher"><br>
                                                                                    Пассивная или с минимальными
                                                                                    затратами <input type="checkbox"
                                                                                        id="passiveParticipation"
                                                                                        class="switcher"><br>
                                                                                </div>
                                                                            </div>

                                                                        </div>
                                                                        <button type="button"
                                                                            onClick="searchBTN()">Искать</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <script>
                                                // Запрос API
                                                function filterSelection(c, checked) {
                                                    // console.log('---')
                                                    let req = {}; // формирование запроса
                                                    req.participation = [];
                                                    req.location = [];
                                                    req.trend = [];

                                                    for (i = 0; i < checked.length; i++) { // перебор всех записей
                                                        if (checked[i].match(/checkbox/ig)) {
                                                            let tmp = '';
                                                            if (checked[i].match(/home/ig)) {
                                                                tmp = 'home'
                                                            } else if (checked[i].match(/nature/ig)) {
                                                                tmp = 'nature'
                                                            }
                                                            req.location.push(tmp)
                                                        } else if (checked[i].match(/Participation/ig)) {
                                                            //    console.log(checked[i], 'yayaya')
                                                            // req.participation.push(checked[i])
                                                            let tmp = '';
                                                            if (checked[i].match(/active/ig)) {
                                                                tmp = 'active'
                                                            } else if (checked[i].match(/passive/ig)) {
                                                                tmp = 'passive'
                                                            }
                                                            req.participation.push(tmp)
                                                        } else {
                                                            req.trend.push(checked[i])
                                                        }
                                                    }
                                                    // отправлять
                                                    var xhr = new XMLHttpRequest();
                                                    console.log(req)
                                                    // xhr.open("POST", "http://localhost:3001/api", true); //"https://citizenscience.ru/api"
                                                    xhr.open("POST", "https://citizenscience.ru/api", true); //""
                                                    xhr.setRequestHeader("Content-Type", "application/json");
                                                    xhr.onreadystatechange = function () {
                                                        if (xhr.readyState === 4 && xhr.status === 200) {
                                                            var json = JSON.parse(xhr.responseText);
                                                            // console.log(json);
                                                            applyFilter(json)
                                                        }
                                                    };
                                                    var data = JSON.stringify(req);
                                                    xhr.send(data);
                                                }
                                            // обработка нажатия кнопки поиска
                                            function searchBTN() {
                                                let checked = []; // Хранилище отмеченных чекбоксов
                                                var checkedBoxes = document.querySelectorAll('input:checked');
                                                if (checkedBoxes.length > 0) {
                                                    checkedBoxes.forEach((check) => {
                                                        checked.push(check.id);
                                                    })
                                                    filterSelection(undefined, checked);
                                                }
                                            }
                                            //---- v2
                                            const fnAtStart = () => {
                                                // var getUrlParameter = function getUrlParameter(sParam) { // получение параметров поиска
                                                //     var sPageURL = window.location.search.substring(1),
                                                //         sURLVariables = sPageURL.split('&'),
                                                //         sParameterName,
                                                //         i;

                                                //     for (i = 0; i < sURLVariables.length; i++) {
                                                //         sParameterName = sURLVariables[i].split('=');

                                                //         if (sParameterName[0] === sParam) {
                                                //             return typeof sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
                                                //         }
                                                //     }
                                                //     return false;
                                                // };

                                                // // Если есть поиск - фильтровать 
                                                // var search = getUrlParameter('search'); // здесь поисковый запрос
                                                // if (search) {
                                                //     const searchArray = search.split(' ');
                                                //     filterSelection(undefined, searchArray);
                                                // } else {
                                                    // filterSelection("all")
                                                // }
                                            }

                                            function applyFilter(data) {
                                                /*
                                                Сформировать html
                                                Засунуть html в div с проектами
                                                */
                                               // 


                                                data = JSON.parse(data.data);
                                                if (data.length > 0) {
                                                    const elem = document.getElementById('projects');
                                                    elem.innerHTML = '';
                                                    for (index = data.length - 1; index >= 0; --index) {
                                                        // console.log(data[index])
                                                        // const project = generateProject(data[index]);

                                                        let html = elem.innerHTML;
                                                        html += generateProject(data[index]);
                                                        elem.innerHTML = html;
                                                        // console.log(html)
                                                    }
                                                }
                                            }

                                            function generateProject(post) {
                                                // console.log(post);
                                                // const post = JSON.parse(postString);
                                                
                                                let project = `
                                                <div class="col-md-6 col-lg-4 mb-4 filterDiv show">
                                                    <div class="card card-bg p-3 h-100">
                                                        <div class="card-body">
                                                            <a href="${post.permalink}" style="text-decoration: none;">
                                                                <h6 class="text-gradient fs--1 fw-bold">
                                                                    ${post.title}
                                                                </h6>
                                                                <hr class="text-100" />
                                                                <div class="d-flex align-items-center">`
                                                                if (post.small_logo) {
                                                                    project += `<img class="me-3 me-md-3" src="/img/projects/${post.img_path}/${post.small_logo}" alt="${post.name}" style="padding-bottom:10px;"/>`;
                                                                }
                                                                project += `<div class="my-3 fs--1">
                                                                        
                                                                        <!-- <p class="fw-normal mb-0">дата<span></span></p> -->
                                                                    </div>
                                                                </div>
                                                                <h5 class="fw-bold lh-base fs-0 text-700">${post.description_short}</h5>
                                                                <div class="d-flex align-items-center mt-4 fs--1">`
                                                                    if (post.participation.includes('активное')) {
                                                                        project += 'активное'
                                                                    }
                                                                    if (post.participation.length === 2) {
                                                                        project += ' и '
                                                                    }
                                                                    if (post.participation.includes('пассивное')) {
                                                                        project += 'пассивное'
                                                                    }

                                                                    project += `  участие<br>Где делать:`;
                                                                    
                                                                    if (post.location.includes('дома')) {
                                                                        project += ` дома`
                                                                    }
                                                                    if (post.location.length === 2) {
                                                                        project += ' и'
                                                                    }
                                                                    if (post.location.includes('улице')) {
                                                                        project += ` на улице`
                                                                    }

                                                                     project += `
                                                                </div>
                                                                <div class="d-flex align-items-center mt-4 fs--1">
                                                                    <!-- <svg class="bi bi-hand-thumbs-up me-2"
                                                                        xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                                        fill="currentColor" viewBox="0 0 16 16">
                                                                        <path
                                                                            d="M8.864.046C7.908-.193 7.02.53 6.956 1.466c-.072 1.051-.23 2.016-.428 2.59-.125.36-.479 1.013-1.04 1.639-.557.623-1.282 1.178-2.131 1.41C2.685 7.288 2 7.87 2 8.72v4.001c0 .845.682 1.464 1.448 1.545 1.07.114 1.564.415 2.068.723l.048.03c.272.165.578.348.97.484.397.136.861.217 1.466.217h3.5c.937 0 1.599-.477 1.934-1.064a1.86 1.86 0 0 0 .254-.912c0-.152-.023-.312-.077-.464.201-.263.38-.578.488-.901.11-.33.172-.762.004-1.149.069-.13.12-.269.159-.403.077-.27.113-.568.113-.857 0-.288-.036-.585-.113-.856a2.144 2.144 0 0 0-.138-.362 1.9 1.9 0 0 0 .234-1.734c-.206-.592-.682-1.1-1.2-1.272-.847-.282-1.803-.276-2.516-.211a9.84 9.84 0 0 0-.443.05 9.365 9.365 0 0 0-.062-4.509A1.38 1.38 0 0 0 9.125.111L8.864.046zM11.5 14.721H8c-.51 0-.863-.069-1.14-.164-.281-.097-.506-.228-.776-.393l-.04-.024c-.555-.339-1.198-.731-2.49-.868-.333-.036-.554-.29-.554-.55V8.72c0-.254.226-.543.62-.65 1.095-.3 1.977-.996 2.614-1.708.635-.71 1.064-1.475 1.238-1.978.243-.7.407-1.768.482-2.85.025-.362.36-.594.667-.518l.262.066c.16.04.258.143.288.255a8.34 8.34 0 0 1-.145 4.725.5.5 0 0 0 .595.644l.003-.001.014-.003.058-.014a8.908 8.908 0 0 1 1.036-.157c.663-.06 1.457-.054 2.11.164.175.058.45.3.57.65.107.308.087.67-.266 1.022l-.353.353.353.354c.043.043.105.141.154.315.048.167.075.37.075.581 0 .212-.027.414-.075.582-.05.174-.111.272-.154.315l-.353.353.353.354c.047.047.109.177.005.488a2.224 2.224 0 0 1-.505.805l-.353.353.353.354c.006.005.041.05.041.17a.866.866 0 0 1-.121.416c-.165.288-.503.56-1.066.56z">
                                                                        </path>
                                                                    </svg>
                                                                    <span class="me-4">34</span>
                                                                    <svg class="bi bi-eye me-2" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                                                        <path
                                                                            d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z">
                                                                        </path>
                                                                        <path
                                                                            d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z">
                                                                        </path>
                                                                    </svg>
                                                                    <span>203</span> -->
                                                                </div>
                                                                <div class="d-flex align-items-center mt-4 fs--1">
                                                                    <a
                                                                        class="btn btn-lg ps-0 pe-3 text-primary"
                                                                        href="${post.url}"
                                                                        style="text-decoration: none"
                                                                        role="button"
                                                                    >
                                                                        Узнать больше
                                                                        <svg
                                                                        class="bi bi-arrow-right-short"
                                                                        xmlns="http://www.w3.org/2000/svg"
                                                                        width="25"
                                                                        height="25"
                                                                        fill="currentColor"
                                                                        viewBox="0 0 16 16"
                                                                        >
                                                                        <path
                                                                            fill-rule="evenodd"
                                                                            d="M4 8a.5.5 0 0 1 .5-.5h5.793L8.146 5.354a.5.5 0 1 1 .708-.708l3 3a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708-.708L10.293 8.5H4.5A.5.5 0 0 1 4 8z"
                                                                        ></path></svg
                                                                    ></a>
                                                                </div>
                                                            </a>
                                                        </div>
                                                    </div>
                                                </div>
                                                `;
                                                return project;
                                            }



                                            function docReady(fn) {  // проверка готовности документа
                                                // see if DOM is already available
                                                if (document.readyState === "complete" || document.readyState === "interactive") {
                                                    // call on next available tick
                                                    setTimeout(fn, 1);
                                                } else {
                                                    document.addEventListener("DOMContentLoaded", fn);
                                                }
                                            }

                                            docReady(fnAtStart); // проверка готовности документа

                                                
                                        </script>
                                        <% } %>
                                            <%- page.content %>
                                    </div>
                    </div>
                </div>

                <div class="container container-md-fluid">
                    <div class="row flex-center h-100 circle-blend circle-blend-left circle-cyan">
                        <div class="col-12">
                            <div class="row align-items-center circle-blend circle-blend-right circle-warning" id="projects">
                                <% if (page.path==='projects/index.html' ) { %>
                                    <% site.posts.data.forEach( post => {%>
                                        <% if (post.title) { %>
                                            <div class="col-md-6 col-lg-4 mb-4 filterDiv show">
                                                <div class="card card-bg p-3 h-100">
                                                    <div class="card-body">
                                                        <a href="<%= post.permalink %>" style="text-decoration: none;">
                                                            <h6 class="text-gradient fs--1 fw-bold">
                                                                <%= post.title %>
                                                            </h6>
                                                            <hr class="text-100" />
                                                            <div class="d-flex align-items-center">
                                                                <% if (post.small_logo) { %>
                                                                    <img class="me-3 me-md-3" src="/img/projects/<%= post.logo_path %>/<%= post.logo %>" alt="<%= post.title %>" style="padding-bottom:10px;"/>
                                                                <% } %>
                                                                <div class="my-3 fs--1">
                                                                    <!-- <p class="mb-0 fw-bold"><%= post.tags %></p> -->
                                                                    <!-- <p class="fw-normal mb-0">дата<span></span></p> -->
                                                                </div>
                                                            </div>
                                                            <h5 class="fw-bold lh-base fs-0 text-700"><%= post.description %></h5>
                                                            <div class="d-flex align-items-center mt-4 fs--1">
                                                                <%= post.participation %> участие<br>
                                                                Где делать: <%= post.location %>
                                                            </div>
                                                            <div class="d-flex align-items-center mt-4 fs--1">
                                                                <!-- <svg class="bi bi-hand-thumbs-up me-2"
                                                                    xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                                    fill="currentColor" viewBox="0 0 16 16">
                                                                    <path
                                                                        d="M8.864.046C7.908-.193 7.02.53 6.956 1.466c-.072 1.051-.23 2.016-.428 2.59-.125.36-.479 1.013-1.04 1.639-.557.623-1.282 1.178-2.131 1.41C2.685 7.288 2 7.87 2 8.72v4.001c0 .845.682 1.464 1.448 1.545 1.07.114 1.564.415 2.068.723l.048.03c.272.165.578.348.97.484.397.136.861.217 1.466.217h3.5c.937 0 1.599-.477 1.934-1.064a1.86 1.86 0 0 0 .254-.912c0-.152-.023-.312-.077-.464.201-.263.38-.578.488-.901.11-.33.172-.762.004-1.149.069-.13.12-.269.159-.403.077-.27.113-.568.113-.857 0-.288-.036-.585-.113-.856a2.144 2.144 0 0 0-.138-.362 1.9 1.9 0 0 0 .234-1.734c-.206-.592-.682-1.1-1.2-1.272-.847-.282-1.803-.276-2.516-.211a9.84 9.84 0 0 0-.443.05 9.365 9.365 0 0 0-.062-4.509A1.38 1.38 0 0 0 9.125.111L8.864.046zM11.5 14.721H8c-.51 0-.863-.069-1.14-.164-.281-.097-.506-.228-.776-.393l-.04-.024c-.555-.339-1.198-.731-2.49-.868-.333-.036-.554-.29-.554-.55V8.72c0-.254.226-.543.62-.65 1.095-.3 1.977-.996 2.614-1.708.635-.71 1.064-1.475 1.238-1.978.243-.7.407-1.768.482-2.85.025-.362.36-.594.667-.518l.262.066c.16.04.258.143.288.255a8.34 8.34 0 0 1-.145 4.725.5.5 0 0 0 .595.644l.003-.001.014-.003.058-.014a8.908 8.908 0 0 1 1.036-.157c.663-.06 1.457-.054 2.11.164.175.058.45.3.57.65.107.308.087.67-.266 1.022l-.353.353.353.354c.043.043.105.141.154.315.048.167.075.37.075.581 0 .212-.027.414-.075.582-.05.174-.111.272-.154.315l-.353.353.353.354c.047.047.109.177.005.488a2.224 2.224 0 0 1-.505.805l-.353.353.353.354c.006.005.041.05.041.17a.866.866 0 0 1-.121.416c-.165.288-.503.56-1.066.56z">
                                                                    </path>
                                                                </svg>
                                                                <span class="me-4">34</span>
                                                                <svg class="bi bi-eye me-2" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                                                    <path
                                                                        d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z">
                                                                    </path>
                                                                    <path
                                                                        d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z">
                                                                    </path>
                                                                </svg>
                                                                <span>203</span> -->
                                                            </div>
                                                            <div class="d-flex align-items-center mt-4 fs--1">
                                                                <a
                                                                    class="btn btn-lg ps-0 pe-3 text-primary"
                                                                    href="<%= post.permalink %>"
                                                                    style="text-decoration: none"
                                                                    role="button"
                                                                >
                                                                    Узнать больше
                                                                    <svg
                                                                    class="bi bi-arrow-right-short"
                                                                    xmlns="http://www.w3.org/2000/svg"
                                                                    width="25"
                                                                    height="25"
                                                                    fill="currentColor"
                                                                    viewBox="0 0 16 16"
                                                                    >
                                                                    <path
                                                                        fill-rule="evenodd"
                                                                        d="M4 8a.5.5 0 0 1 .5-.5h5.793L8.146 5.354a.5.5 0 1 1 .708-.708l3 3a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708-.708L10.293 8.5H4.5A.5.5 0 0 1 4 8z"
                                                                    ></path></svg
                                                                ></a>
                                                            </div>
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                        <% } %>
                                    <% }) %>
                                <% } %>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="container container-md-fluid">
                    <div class="row flex-center h-100 circle-blend circle-blend-left circle-cyan">
                        <div class="col-12">
                            <!-- Yandex.RTB -->
<script>window.yaContextCb=window.yaContextCb||[]</script>
<script src="https://yandex.ru/ads/system/context.js" async></script>
<!-- Yandex.RTB R-A-2145405-1 -->
<div id="yandex_rtb_R-A-2145405-1"></div>
<script>window.yaContextCb.push(()=>{
  Ya.Context.AdvManager.render({
    renderTo: 'yandex_rtb_R-A-2145405-1',
    blockId: 'R-A-2145405-1'
  })
})</script>
                        </div>
                    </div>
                </div>
                <%- include('partial/page-footer.ejs') %>
    </main>
    <%- include('partial/footer.ejs') %>
